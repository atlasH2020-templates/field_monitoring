openapi: 3.0.1
info:
  title: Field monitoring service template
  description: Agricultural services for Field monitoring
  version: 0.1.1
paths:
  /indices/list:
    get:
      tags:
        - Indices List
      summary: List of available Indices
      operationId: getIndicesList
      responses:
        '200':
          description: List of available Indices
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Indices'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: 500 Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: 503 Service Unavailable
  /indices/{field_urn}/search:
    post:
      operationId: searchIndicesByDateRange
      tags:
        - Indices Search
      summary: List of available Indices by date range
      parameters:
        - name: field_urn
          in: path
          schema:
            type: string
            example: urn:service_id:id
          description: The Field Uniform Resource Name
          required: true
      requestBody:
        description: Request for available Field Growth indexes by date range. A service incapable of providing such information should return all requested dates & indices as available.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IndicesSearchRequest'
        required: true
      responses:
        '200':
          description: List of available Indices
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndicesSearchResults'
        '204':
          description: Not available Content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: '204 No content: Not available Index'
        '400':
          description: Invalid Date range or Index
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: '400 Bad Request: invalid Data range or Invalid Index'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: 500 Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: 503 Service Unavailable
  /indices/{field_urn}/download/{index}:
    get:
      tags:
        - Indices Download
      summary: Get Indices results
      operationId: DownloadIndice
      parameters:
        - name: field_urn
          in: path
          schema:
            type: string
            example: urn:service_id:id
          description: The Field Uniform Resource Name
          required: true
        - name: index
          in: path
          schema:
            type: string
            example: ndvi
          description: Name of field monitoring index
          required: true
        - in: query
          name: date
          schema:
            type: string
            format: date
            example: '2019-05-17'
            pattern: ^\d{4}-\d{2}-\d{2}$
          description: The date to use for the retrieval of the indicator. If omitted, the current date will be used.
          required: false
      responses:
        '200':
          description: Field Monitoring index
          content:
            image/geotiff:
              schema:
                type: string
                format: binary
                example: image/geotiff
        '204':
          description: Not available Content
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: '204 No content: Not available Index'
        '400':
          description: Invalid Field URN
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: '400 Bad Request: Field URN is invalid'
        '404':
          description: Unknown Field URN
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: '404 Not Found: Field URN not found'
        '406':
          description: Field index out of geospatial bounds
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: '406 Not Acceptable: Field index out of geospatial bounds'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: 500 Internal Server Error
        '503':
          description: Service Unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorMessage'
              example:
                description: 503 Service Unavailable

components:
  schemas:
    Index:
      type: string
      description: Name of Index.
      enum:
        - ndvi
        - biomass
        - lai
        - chl-lai
        - canopy-water-content
        - yield-estimation
        - crop-residues
        
    IndexSearch:
      type: object
      properties:
        download_url:
          type: string
          description: 'product_download_url' 
          example: '/indices/{field_urn}/download/{index}?date={date}'
        index:
          type: string
          items :
            $ref: '#/components/schemas/Index'
          description: Index Name.
          example: "ndvi"
    
    Indices:
      type: array
      items:
        $ref: '#/components/schemas/Index'
        
        
    DateResults:
      type: object
      properties:
        date:
          type: string
          description: Available Dates
          example: '2019-05-17'
        indices:
          type: array
          items:
            $ref: '#/components/schemas/IndexSearch'
          description: Available Indices.
   
   
    IndicesSearchResults:
      type: array
      items:
        $ref: '#/components/schemas/DateResults'
    
    
    IndicesSearchRequest:
      type: object
      required:
        - indices
        - date_from
      properties:
        indices:
          type: array
          items:
            $ref: '#/components/schemas/Index'
          description: List of the farm monitoring indices
        date_from:
          type: string
          format: date_from
          description: The start date to use for the retrieval of the indicator.
        date_to:
          type: string
          format: date_to
          description: If date omitted the current date will be used.
   
   
    ErrorMessage:
      type: object
      description: This defines the structure of an error
      properties:
        message:
          type: string
          description: error description
        status:
          type: integer
          description : number of HTTP error
      required:
        - message
        - status
      example:
        status: 401
        message: No valid Access Token